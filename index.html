<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Client-side temperament finding</title>
        <style type="text/css">
            table.mapping {
                margin-bottom: 1em;
            }
            .mapping td {
                text-align: right;
                padding-right: 1em;
            }
            #regular-temperament {
                display: none;
            }
            .show-temperament #regular-temperament {
                display: block;
                margin-bottom: 2em;
            }
            #temperament-list {
                display: none;
            }
            .show-list #temperament-list {
                display: block;
            }
        </style>
    </head>
    <body>
        <noscript>
            This page uses JavaScript and WebAssembly.
            You'll need to enable scripting for it to work,
            and even then it might not.
        </noscript>
        <form>
            <p>
                <label>
                    Prime limit
                    <input id="prime-limit" value="" size="2">
                </label>
            </p>
            <p>
                <label>
                    Badness parameter
                    <input id="prime-eka" value="1.0" size="5">
                    cents
                </label>
            </p>
            <p>
                <label>
                    Number of results
                    <input id="n-results" value="10" size="2">
                </label>
            </p>
            <button>Search</button>
        </form>
        <div id="regular-temperament">
            <h3 id="rt-name">A result will go here</h3>
            <h4>Equal Temperament Mappings</h4>
            <table id="rt-etmap" class="mapping"></table>
            <h4>Reduced Mapping</h4>
            <table id="rt-redmap" class="mapping"></table>
            <h4>TE Generator Tunings (cents)</h4>
            <table id="rt-generators" class="mapping"></table>
            <h4>POTE Generator Tunings (cents)</h4>
            <table id="rt-pote-generators" class="mapping"></table>
            <h4>TE Step Tunings (cents)</h4>
            <table id="rt-steps" class="mapping"></table>
            <h4>POTE Step Tunings (cents)</h4>
            <table id="rt-pote-steps" class="mapping"></table>
            <h4>TE Tuning Map (cents)</h4>
            <table id="rt-tuning-map" class="mapping"></table>
            <h4>POTE Tuning Map (cents)</h4>
            <table id="rt-pote-tuning-map" class="mapping"></table>
            <h4>TE mistunings (cents)</h4>
            <table id="rt-mistunings" class="mapping"></table>
            <h4>POTE mistunings (cents)</h4>
            <table id="rt-pote-mistunings" class="mapping"></table>
            <table>
                <tr><td>Complexity</td><td id="rt-complexity"></td></tr>
                <tr>
                    <td>Adjusted Error</td>
                    <td id="error"></td>
                    <td>cents</td>
                </tr>
                <tr>
                    <td>TE Error</td>
                    <td id="rt-te-error"></td>
                    <td>cents/octave</td>
                </tr>
            </table>
        </div>
        <div id="temperament-list">
            Results will go here
        </div>
        <script type="module">
            import init, { consecutive_prime_limit_search }
                from './pkg/regular.js'

            async function run() {
                await init()
            }

            document.querySelector("form").onsubmit =
                function(evt) {
                    evt.preventDefault();
                    var limit = parseInt(
                        document.getElementById("prime-limit").value,
                        10)
                    var eka = parseFloat(
                        document.getElementById("prime-eka").value)
                    var nresults = parseInt(
                        document.getElementById("n-results").value)
                    consecutive_prime_limit_search(limit, eka, nresults)
                }

            run()
        </script>
    </body>
</html>
